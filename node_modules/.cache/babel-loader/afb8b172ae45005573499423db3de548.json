{"ast":null,"code":"class Game {\n  constructor(_dimension) {\n    this.getRandomNumber = () => Math.random() > .1 ? 2 : 4;\n\n    this.getRandomArrayIndex = arr => Math.floor(arr.length * Math.random());\n\n    this.isGameWon = board => {\n      const {\n        dimension\n      } = this;\n\n      for (let i = 0; i < dimension; i++) {\n        for (let j = 0; j < dimension; j++) {\n          if (board[i][j] === 2048) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    };\n\n    this.isGameOver = board => {\n      const {\n        dimension\n      } = this;\n\n      for (let col = 0; col < dimension; col++) {\n        for (let row = 0; row < dimension; row++) {\n          if (board[col][row] === 0 || col !== dimension - 1 && board[col][row] === board[col + 1][row] || row !== dimension - 1 && board[col][row] === board[col][row + 1]) return false;\n        }\n      }\n\n      return true;\n    };\n\n    this.onMove = callback => this.moveCallback = callback;\n\n    this.onWin = callback => this.winCallback = callback;\n\n    this.onLose = callback => this.loseCallback = callback;\n\n    this.dimension = _dimension;\n    this.setupNewGame();\n  }\n\n  setupNewGame() {\n    const board = this.blankGrid();\n    this.addNumber(board);\n    this.addNumber(board);\n    this.gameState = {\n      board: this.convertTo1D(board),\n      score: 0,\n      won: false,\n      over: false\n    };\n  }\n\n  loadGame(gameState) {\n    this.gameState = gameState;\n  }\n\n  addNumber(board) {\n    const openings = [],\n          {\n      dimension\n    } = this;\n\n    for (let i = 0; i < dimension; i++) {\n      for (let j = 0; j < dimension; j++) {\n        if (board[i][j] === 0) openings.push({\n          col: i,\n          row: j\n        });\n      }\n    }\n\n    if (openings.length === 0) return;\n    const target = openings[this.getRandomArrayIndex(openings)];\n    board[target.col][target.row] = this.getRandomNumber() >= 0.1 ? 2 : 4;\n  }\n\n  move(direction) {\n    let turned = false,\n        transposed = false,\n        notArrowKey = false;\n    let board = this.convertTo2D(this.gameState.board);\n\n    switch (direction) {\n      case 'up':\n        board = this.turnBoard(board);\n        turned = true;\n        break;\n\n      case 'left':\n        board = this.transposeBoard(board);\n        board = this.turnBoard(board);\n        turned = true;\n        transposed = true;\n        break;\n\n      case 'right':\n        board = this.transposeBoard(board);\n        transposed = true;\n        break;\n\n      default:\n        notArrowKey = direction !== 'down';\n    }\n\n    if (notArrowKey) return;\n    const copy = this.duplicate(board);\n\n    for (let i = 0; i < this.dimension; i++) board[i] = this.translate(this.merge(this.translate(board[i])));\n\n    const different = this.isDifferent(copy, board);\n    if (turned) board = this.turnBoard(board);\n    if (transposed) board = this.transposeBoard(board);\n    if (different) this.addNumber(board);\n    this.gameState.over = this.isGameOver(board);\n    this.gameState.won = this.isGameWon(board);\n    if (this.gameState.won && this.winCallback) this.winCallback();else if (!this.gameState.won && this.gameState.over && this.loseCallback) this.loseCallback();\n    this.gameState.board = this.convertTo1D(board);\n    this.moveCallback(this);\n  }\n\n  blankGrid() {\n    const grid = [],\n          {\n      dimension\n    } = this;\n\n    for (let i = 0; i < dimension; i++) {\n      grid.push(Array(dimension).fill(0));\n    }\n\n    return grid;\n  }\n\n  convertTo2D(board) {\n    const board2D = this.blankGrid();\n    board.forEach((value, idx) => board2D[Math.floor(idx % this.dimension)][Math.floor(idx / this.dimension)] = value);\n    return board2D;\n  }\n\n  convertTo1D(board) {\n    const {\n      dimension\n    } = this,\n          board1D = Array(dimension * dimension).fill(0);\n    let counter = 0;\n\n    for (let row = 0; row < dimension; row++) {\n      for (let col = 0; col < dimension; col++) {\n        board1D[counter++] = board[col][row];\n      }\n    }\n\n    return board1D;\n  }\n\n  duplicate(board) {\n    const {\n      dimension\n    } = this,\n          copy = this.blankGrid();\n\n    for (let col = 0; col < dimension; col++) {\n      for (let row = 0; row < dimension; row++) {\n        copy[col][row] = board[col][row];\n      }\n    }\n\n    return copy;\n  }\n\n  isDifferent(arr1, arr2) {\n    const {\n      dimension\n    } = this;\n\n    for (let i = 0; i < dimension; i++) {\n      for (let j = 0; j < dimension; j++) {\n        if (arr1[i][j] !== arr2[i][j]) return true;\n      }\n    }\n\n    return false;\n  }\n\n  translate(row) {\n    const rowNumbers = row.filter(number => number);\n    const empties = Array(this.dimension - rowNumbers.length).fill(0);\n    return empties.concat(rowNumbers);\n  }\n\n  merge(row) {\n    for (let i = this.dimension - 1; i >= 1; i--) {\n      const val1 = row[i];\n      const val2 = row[i - 1];\n\n      if (val1 === val2) {\n        const combinedValue = val1 + val2;\n        row[i] = combinedValue;\n        this.gameState.score += combinedValue;\n        row[i - 1] = 0;\n      }\n    }\n\n    return row;\n  }\n\n  turnBoard(board) {\n    for (let i = 0; i < this.dimension; i++) board[i].reverse();\n\n    return board;\n  }\n\n  transposeBoard(board) {\n    const transposedBoard = this.blankGrid(),\n          {\n      dimension\n    } = this;\n\n    for (let col = 0; col < dimension; col++) {\n      for (let row = 0; row < dimension; row++) {\n        transposedBoard[col][row] = board[row][col];\n      }\n    }\n\n    return transposedBoard;\n  }\n\n  getGameState() {\n    return this.gameState;\n  }\n\n  toString() {\n    const board = this.gameState.board;\n  }\n\n}\n\nexport default Game;","map":{"version":3,"sources":["/home/mitchell/School/426/2048/src/Game.js"],"names":["Game","constructor","dimension","getRandomNumber","Math","random","getRandomArrayIndex","arr","floor","length","isGameWon","board","i","j","isGameOver","col","row","onMove","callback","moveCallback","onWin","winCallback","onLose","loseCallback","setupNewGame","blankGrid","addNumber","gameState","convertTo1D","score","won","over","loadGame","openings","push","target","move","direction","turned","transposed","notArrowKey","convertTo2D","turnBoard","transposeBoard","copy","duplicate","translate","merge","different","isDifferent","grid","Array","fill","board2D","forEach","value","idx","board1D","counter","arr1","arr2","rowNumbers","filter","number","empties","concat","val1","val2","combinedValue","reverse","transposedBoard","getGameState","toString"],"mappings":"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","sourcesContent":["class Game {\n    \n    constructor(dimension) {\n        this.dimension = dimension;\n        this.setupNewGame()\n    }\n\n    setupNewGame() {\n        const board  = this.blankGrid();\n        this.addNumber(board);\n        this.addNumber(board);\n\n        this.gameState = {\n            board: this.convertTo1D(board),\n            score: 0,\n            won: false,\n            over: false\n        }\n    }\n\n    loadGame(gameState) {\n        this.gameState = gameState;\n    }\n\n    addNumber(board) {\n        const openings = [], { dimension } = this;\n\n        for (let i = 0; i < dimension; i++) {\n            for (let j = 0; j < dimension; j++) {\n                if (board[i][j] === 0) \n                    openings.push({col: i, row: j});\n                \n            }\n        }\n\n        if(openings.length === 0)\n            return;\n\n        const target = openings[this.getRandomArrayIndex(openings)];\n        board[target.col][target.row] = this.getRandomNumber() >= 0.1 ? 2 : 4;\n    }\n\n    move(direction) {\n        let turned = false, transposed = false, notArrowKey = false;\n        let board = this.convertTo2D(this.gameState.board);\n\n        switch(direction) {\n            case 'up':\n                board = this.turnBoard(board);\n                turned = true;\n                break;\n            case 'left':\n                board  = this.transposeBoard(board);\n                board = this.turnBoard(board);\n                turned = true;\n                transposed = true;\n                break;\n            case 'right':\n                board = this.transposeBoard(board);\n                transposed = true;\n                break;\n            default: notArrowKey = direction !== 'down';\n        }\n\n        if(notArrowKey)\n            return;\n\n        const copy = this.duplicate(board);\n\n        for(let i = 0; i < this.dimension; i++) \n            board[i] = this.translate(this.merge(this.translate(board[i])));\n\n        const different = this.isDifferent(copy, board);\n\n        if(turned)\n            board = this.turnBoard(board);\n        \n        if(transposed)\n            board = this.transposeBoard(board);\n\n        if(different)\n            this.addNumber(board);\n\n        \n        this.gameState.over = this.isGameOver(board);\n        this.gameState.won = this.isGameWon(board);\n\n        if(this.gameState.won && this.winCallback)\n            this.winCallback();\n        else if(!this.gameState.won && this.gameState.over && this.loseCallback)\n            this.loseCallback();\n        \n        this.gameState.board = this.convertTo1D(board);\n        this.moveCallback(this);\n    }\n\n    getRandomNumber = () => Math.random() > .1 ? 2 : 4;\n    getRandomArrayIndex = arr => Math.floor(arr.length * Math.random());\n\n    blankGrid() {\n        const grid = [], { dimension } = this;\n        for(let i = 0; i < dimension; i++) {\n            grid.push(Array(dimension).fill(0));\n        }\n        return grid;\n    }\n\n    convertTo2D(board) {\n        const board2D = this.blankGrid();\n        board.forEach((value, idx) => board2D[Math.floor(idx % this.dimension)][Math.floor(idx / this.dimension)] = value);\n        return board2D;\n    }\n\n    convertTo1D(board) {\n        const { dimension } = this, board1D = Array(dimension*dimension).fill(0);\n\n        let counter = 0;\n\n        for(let row = 0; row < dimension; row++) {\n            for(let col = 0; col < dimension; col++) {\n                board1D[counter++] = board[col][row];\n            }\n        }\n        return board1D;\n    }\n\n    duplicate(board) {\n        const { dimension } = this, copy = this.blankGrid();\n\n        for (let col = 0; col < dimension; col++) {\n            for (let row = 0; row < dimension; row++) {\n                copy[col][row] = board[col][row];\n            }\n        }\n\n        return copy;\n    }\n\n    isDifferent(arr1, arr2) {\n        const { dimension } = this;\n        for (let i = 0; i < dimension; i++) {\n            for (let j = 0; j < dimension; j++) {\n                if (arr1[i][j] !== arr2[i][j]) \n                    return true;\n            }\n        }\n        return false;\n    }\n\n    translate(row) {\n        const rowNumbers = row.filter(number => number);\n        const empties = Array(this.dimension-rowNumbers.length).fill(0);\n        return empties.concat(rowNumbers);\n    }\n\n    merge(row) {\n        for (let i = this.dimension-1; i >= 1; i--) {\n            const val1 = row[i];\n            const val2 = row[i-1];\n\n            if (val1 === val2) {\n                const combinedValue = val1 + val2;\n                row[i] = combinedValue;\n                this.gameState.score += combinedValue;\n                row[i-1] = 0;\n            }\n        }\n        return row;\n    }\n\n    turnBoard(board) {\n        for(let i = 0; i < this.dimension; i++) \n            board[i].reverse();\n        return board;\n    }\n\n    transposeBoard(board) {\n        const transposedBoard = this.blankGrid(), { dimension } = this;\n\n        for (let col = 0; col < dimension; col++) {\n            for (let row = 0; row < dimension; row++) {\n                transposedBoard[col][row] = board[row][col];\n            }\n        }\n        \n        return transposedBoard;\n    }\n\n    isGameWon = board => {\n        const { dimension } = this;\n\n        for (let i = 0; i < dimension; i++) {\n          for (let j = 0; j < dimension; j++) {\n            if (board[i][j] === 2048) {\n              return true;\n            }\n          }\n        }\n        return false;\n    }\n\n    isGameOver = board => {\n\n        const { dimension } = this;\n\n        for (let col = 0; col < dimension; col++) {\n            for (let row = 0; row < dimension; row++) {\n                \n                if ((board[col][row] === 0) || (col !== dimension-1 && board[col][row] === board[col + 1][row]) \n                        || (row !== dimension-1 && board[col][row] === board[col][row + 1])) \n                    return false;\n            \n            }\n        }\n        return true;\n    }\n\n    getGameState() {\n        return this.gameState;\n    }\n\n    toString() {\n        const board = this.gameState.board\n    }\n\n    onMove = callback => this.moveCallback = callback;\n    onWin = callback => this.winCallback = callback;\n    onLose = callback => this.loseCallback = callback;\n\n}\n\nexport default Game;"]},"metadata":{},"sourceType":"module"}